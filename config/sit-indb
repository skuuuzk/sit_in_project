CREATE TABLE USERS (
    IDNO INT(11)  AUTO_INCREMENT PRIMARY KEY,
    LASTNAME VARCHAR(20) NOT NULL,
    FIRSTNAME VARCHAR(20) NOT NULL,
    MIDNAME VARCHAR(20),
    COURSE VARCHAR(50) NOT NULL,
    YEAR VARCHAR(15) NOT NULL,
    USERNAME VARCHAR(30) UNIQUE NOT NULL,
    PASSWORD VARCHAR(255) NOT NULL,
    SESSION INT(11) DEFAULT 30,
    PROFILE_PIC VARCHAR(255) DEFAULT 'img/default.png',
    EMAIL VARCHAR(255) NULL,
    ADDRESS VARCHAR(255) NOT NULL
)

CREATE TABLE ADMIN (
    ADMIN_ID INT(11) AUTO_INCREMENT PRIMARY KEY,
    USERNAME VARCHAR(30) UNIQUE NOT NULL,
    PASSWORD VARCHAR(255) NOT NULL
)

CREATE TABLE ANNOUNCEMENT (
    ANNOUNCE_ID INT(11) AUTO_INCREMENT PRIMARY KEY,
    TITLE VARCHAR(255) NOT NULL,
    CONTENT TEXT NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    ADMIN_ID INT(11),
    FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN(ADMIN_ID) ON DELETE CASCADE
)

-- Create SITIN table if it doesn't exist
CREATE TABLE IF NOT EXISTS `SITIN` (
  `SITIN_ID` int(11) NOT NULL AUTO_INCREMENT,
  `IDNO` varchar(20) NOT NULL,
  `LAB_ID` int(11) NOT NULL,
  `ADMIN_ID` int(11) NOT NULL,
  `PURPOSE` varchar(100) NOT NULL,
  `SESSION_START` datetime NOT NULL,
  `SESSION_END` datetime DEFAULT NULL,
  `SESSION_DURATION` int(11) NOT NULL COMMENT 'Duration in hours',
  `STATUS` enum('ACTIVE','COMPLETED','CANCELLED') NOT NULL DEFAULT 'ACTIVE',
  `REMARKS` text DEFAULT NULL,
  `CREATED_AT` timestamp NOT NULL DEFAULT current_timestamp(),
  `UPDATED_AT` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`SITIN_ID`),
  KEY `IDX_SITIN_IDNO` (`IDNO`),
  KEY `IDX_SITIN_LAB_ID` (`LAB_ID`),
  KEY `IDX_SITIN_ADMIN_ID` (`ADMIN_ID`),
  KEY `IDX_SITIN_SESSION_START` (`SESSION_START`),
  KEY `IDX_SITIN_STATUS` (`STATUS`),
  CONSTRAINT `FK_SITIN_IDNO` FOREIGN KEY (`IDNO`) REFERENCES `USERS` (`IDNO`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_SITIN_LAB_ID` FOREIGN KEY (`LAB_ID`) REFERENCES `LABORATORY` (`LAB_ID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_SITIN_ADMIN_ID` FOREIGN KEY (`ADMIN_ID`) REFERENCES `ADMIN` (`ADMIN_ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Create LABORATORY table if it doesn't exist
CREATE TABLE IF NOT EXISTS `LABORATORY` (
  `LAB_ID` int(11) NOT NULL AUTO_INCREMENT,
  `LAB_NAME` varchar(100) NOT NULL,
  `LAB_DESCRIPTION` text DEFAULT NULL,
  `CAPACITY` int(11) NOT NULL DEFAULT 30,
  `STATUS` enum('AVAILABLE','MAINTENANCE','OCCUPIED') NOT NULL DEFAULT 'AVAILABLE',
  `CREATED_AT` timestamp NOT NULL DEFAULT current_timestamp(),
  `UPDATED_AT` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`LAB_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Insert sample laboratories if none exist
INSERT INTO `LABORATORY` (`LAB_NAME`, `LAB_DESCRIPTION`, `CAPACITY`, `STATUS`)
SELECT 'Lab 524', 'Computer Laboratory Room 524', 30, 'AVAILABLE'
WHERE NOT EXISTS (SELECT 1 FROM `LABORATORY` LIMIT 1);

INSERT INTO `LABORATORY` (`LAB_NAME`, `LAB_DESCRIPTION`, `CAPACITY`, `STATUS`)
SELECT 'Lab 526', 'Computer Laboratory Room 526', 25, 'AVAILABLE'
WHERE NOT EXISTS (SELECT 2 FROM `LABORATORY` LIMIT 1);

INSERT INTO `LABORATORY` (`LAB_NAME`, `LAB_DESCRIPTION`, `CAPACITY`, `STATUS`)
SELECT 'Lab 528', 'Computer Laboratory Room 528', 20, 'AVAILABLE'
WHERE NOT EXISTS (SELECT 3 FROM `LABORATORY` LIMIT 1);

INSERT INTO `LABORATORY` (`LAB_NAME`, `LAB_DESCRIPTION`, `CAPACITY`, `STATUS`)
SELECT 'Lab 530', 'Computer Laboratory Room 530', 30, 'AVAILABLE'
WHERE NOT EXISTS (SELECT 4 FROM `LABORATORY` LIMIT 1);

INSERT INTO `LABORATORY` (`LAB_NAME`, `LAB_DESCRIPTION`, `CAPACITY`, `STATUS`)
SELECT 'Lab 542', 'Computer Laboratory Room 542', 25, 'AVAILABLE'
WHERE NOT EXISTS (SELECT 5 FROM `LABORATORY` LIMIT 1);

INSERT INTO `LABORATORY` (`LAB_NAME`, `LAB_DESCRIPTION`, `CAPACITY`, `STATUS`)
SELECT 'Lab 544', 'Computer Laboratory Room 544', 15, 'AVAILABLE'
WHERE NOT EXISTS (SELECT 6 FROM `LABORATORY` LIMIT 1);